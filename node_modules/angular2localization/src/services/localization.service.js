/**
 * ANGULAR 2 LOCALIZATION
 * An Angular 2 library to translate messages, dates and numbers.
 * Written by Roberto Simonetti.
 * MIT license.
 * https://github.com/robisim74/angular2localization
 */
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require('@angular/core');
var http_1 = require('@angular/http');
var Observable_1 = require('rxjs/Observable');
require('rxjs/add/operator/map');
// Services.
var locale_service_1 = require('./locale.service');
var Intl_support_1 = require('./Intl-support');
/**
 * LocalizationService class.
 *
 * Direct loading.
 *
 * To initialize LocalizationService for the direct loading, add the following code in the body of constructor of the route component:
 *
 * var translationEN = {
 *      TITLE: 'Angular 2 Localization',
 *      CHANGE_LANGUAGE: 'Change language',
 *      ...
 * }
 * // Add a new translation here.
 *
 * // Required: adds a new translation with the given language code.
 * this.localization.addTranslation('en', translationEN);
 * // Add a new translation with the given language code here.
 * this.localization.updateTranslation(); // Need to update the translation.
 *
 * Asynchronous loading.
 *
 * To initialize LocalizationService for the asynchronous loading, add the following code in the body of constructor of the route component:
 *
 * // Required: initializes the translation provider with the given path prefix.
 * this.localization.translationProvider('./resources/locale-');
 * this.localization.updateTranslation(); // Need to update the translation.
 *
 * and create the json files of the translations such as 'locale-en.json':
 *
 * {
 *     "TITLE": "Angular 2 Localization",
 *     "CHANGE_LANGUAGE": "Change language",
 *     ...
 * }
 *
 * @author Roberto Simonetti
 */
var LocalizationService = (function () {
    function LocalizationService(http, locale) {
        this.http = http;
        this.locale = locale;
        /**
         * The translation data: {languageCode: {key: value}}.
         */
        this.translationData = {};
        this.prefix = "";
        this.loadingMode = LoadingMode.Unknown;
        this.languageCode = "";
        // Initializes the loading mode.
        this.loadingMode = LoadingMode.Direct;
        // Initializes the service state.
        this.serviceState = ServiceState.isWaiting;
    }
    /**
     * Direct loading: adds new translation data.
     *
     * @param language The two-letter code of the language for the translation data
     * @param translation The new translation data
     */
    LocalizationService.prototype.addTranslation = function (language, translation) {
        // Adds the new translation data.
        this.translationData[language] = translation;
    };
    /**
     * Asynchronous loading: defines the translation provider.
     *
     * @param prefix The path prefix of the json files
     */
    LocalizationService.prototype.translationProvider = function (prefix) {
        this.prefix = prefix;
        // Updates the loading mode.
        this.loadingMode = LoadingMode.Async;
    };
    /**
     * Gets the json data.
     */
    LocalizationService.prototype.getTranslation = function () {
        var _this = this;
        // Initializes the translation data & the service state.
        this.translationData = {};
        this.serviceState = ServiceState.isLoading;
        var url = this.prefix + this.locale.getCurrentLanguage() + '.json';
        // Angular 2 Http module.
        this.http.get(url)
            .map(function (res) { return res.json(); })
            .subscribe(
        // Observer or next.
        function (res) {
            // Assigns the observer to the translation data.
            _this.translationData[_this.locale.getCurrentLanguage()] = res;
        }, 
        // Error.
        function (error) {
            console.error("Localization service:", error);
        }, 
        // Complete.
        function () {
            // Updates the language code of the service.
            _this.languageCode = _this.locale.getCurrentLanguage();
            // Updates the service state.
            _this.serviceState = ServiceState.isReady;
        });
    };
    /**
     * Translates a key.
     *
     * @param key The key to be translated
     * @return The value of translation
     */
    LocalizationService.prototype.translate = function (key) {
        var value;
        if (this.translationData[this.languageCode] != null) {
            // Gets the translation by language code. 
            var translation = this.translationData[this.languageCode];
            // Gets the value of translation by key.   
            value = translation[key];
        }
        // If the value of translation is not present, the same key is returned (see issue #1).
        if (value == null || value == "") {
            value = key;
        }
        return value;
    };
    /**
     * Translates a key.
     *
     * @param key The key to be translated
     * @return An observable of the value of translation
     */
    LocalizationService.prototype.translateAsync = function (key) {
        var _this = this;
        return new Observable_1.Observable(function (observer) {
            // Gets the value of translation for the key.
            var value = _this.translate(key);
            observer.next(value);
            observer.complete();
        });
    };
    /**
     * Updates the language code and loads the translation data for the asynchronous loading.
     */
    LocalizationService.prototype.updateTranslation = function () {
        if (this.locale.getCurrentLanguage() != "" && this.locale.getCurrentLanguage() != this.languageCode) {
            // Asynchronous loading.
            if (this.loadingMode == LoadingMode.Async) {
                // Updates the translation data.  
                this.getTranslation();
            }
            else {
                // Updates the language code of the service.
                this.languageCode = this.locale.getCurrentLanguage();
                // Updates the service state.
                this.serviceState = ServiceState.isReady;
            }
        }
    };
    /* Intl.Collator */
    /**
     * Compares two keys by the value of translation & the current language code.
     *
     * @param key1, key2 The keys of the values to compare
     * @param extension
     * @param options
     * @return A negative value if the value of translation of key1 comes before the value of translation of key2; a positive value if key1 comes after key2; 0 if they are considered equal or Intl.Collator is not supported
     * @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Collator
     */
    LocalizationService.prototype.compare = function (key1, key2, extension, options) {
        // Checks for support for Intl.
        if (Intl_support_1.IntlSupport.Collator(this.languageCode) == false) {
            return 0;
        }
        // Gets the value of translation for the keys.
        var value1 = this.translate(key1);
        var value2 = this.translate(key2);
        ;
        var locale = this.addExtension(this.languageCode, extension);
        return new Intl.Collator(locale).compare(value1, value2);
    };
    /**
     * Sorts an array of objects or an array of arrays by the current language code.
     *
     * @param list The array to be sorted
     * @param keyName The column that contains the keys of the values to be ordered
     * @param order 'asc' or 'desc'. The default value is 'asc'.
     * @param extension
     * @param options
     * @return The same sorted list or the same list if Intl.Collator is not supported
     * @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Collator
     */
    LocalizationService.prototype.sort = function (list, keyName, order, extension, options) {
        if (list == null || keyName == null || Intl_support_1.IntlSupport.Collator(this.languageCode) == false)
            return list;
        // Gets the value of translation for the keys.
        for (var _i = 0, list_1 = list; _i < list_1.length; _i++) {
            var item = list_1[_i];
            // Gets the value of translation for the key.
            var value = this.translate(item[keyName]);
            // Adds a new column for translated values.
            var translated = keyName.concat("Translated");
            // Updates the value in the list.
            item[translated] = value;
        }
        var locale = this.addExtension(this.languageCode, extension);
        // Intl.Collator.
        var collator = new Intl.Collator(locale, options); // It can be passed directly to Array.prototype.sort.
        list.sort(function (a, b) {
            return collator.compare(a[translated], b[translated]);
        });
        // Removes the column of translated values.
        var index = list.indexOf(translated, 0);
        if (index > -1) {
            list.splice(index, 1);
        }
        // Descending order.
        if (order != null && order == 'desc') {
            list.reverse();
        }
        return list;
    };
    /**
     * Sorts an array of objects or an array of arrays by the current language code.
     *
     * @param list The array to be sorted
     * @param keyName The column that contains the keys of the values to be ordered
     * @param order 'asc' or 'desc'. The default value is 'asc'.
     * @param extension
     * @param options
     * @return An observable of the sorted list or of the same list if Intl.Collator is not supported
     * @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Collator
     */
    LocalizationService.prototype.sortAsync = function (list, keyName, order, extension, options) {
        var _this = this;
        return new Observable_1.Observable(function (observer) {
            // Gets the sorted list.
            observer.next(_this.sort(list, keyName, order, extension, options));
            observer.complete();
        });
    };
    /**
     * Matches a string into an array of objects or an array of arrays.
     *
     * @param s The string to search
     * @param list The array to look for
     * @param keyNames An array that contains the columns to look for
     * @param options
     * @return A filtered list or the same list if Intl.Collator is not supported
     * @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Collator
     */
    LocalizationService.prototype.search = function (s, list, keyNames, options) {
        var _this = this;
        if (options === void 0) { options = { usage: 'search' }; }
        if (list == null || keyNames == null || s == "" || Intl_support_1.IntlSupport.Collator(this.languageCode) == false)
            return list;
        // Gets the value of translation for the each column.
        var translated = new Array();
        var i = 0;
        for (var i = 0; i < keyNames.length; i++) {
            // Adds a new column for translated values.
            translated.push(keyNames[i].concat("Translated"));
            for (var _i = 0, list_2 = list; _i < list_2.length; _i++) {
                var item = list_2[_i];
                // Gets the values of translation for the column.
                var value = this.translate(item[keyNames[i]]);
                // Updates the value in the list.
                item[translated[i]] = value;
            }
        }
        var locale = this.languageCode;
        // Intl.Collator.
        var collator = new Intl.Collator(locale, options);
        var matches = list.filter(function (v) {
            var found = false;
            for (var i = 0; i < translated.length; i++) {
                // Calls matching algorithm.
                if (_this.match(v[translated[i]], s, collator)) {
                    found = true;
                    break;
                }
            }
            return found;
        });
        // Removes the columns of translated values.
        for (var i = 0; i < translated.length; i++) {
            var index = matches.indexOf(translated[i], 0);
            if (index > -1) {
                matches.splice(index, 1);
            }
        }
        return matches;
    };
    /**
     * Matches a string into an array of objects or an array of arrays.
     *
     * @param s The string to search
     * @param list The array to look for
     * @param keyNames An array that contains the columns to look for
     * @param options
     * @return An observable for each element of the filtered list or the same list if Intl.Collator is not supported
     * @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Collator
     */
    LocalizationService.prototype.searchAsync = function (s, list, keyNames, options) {
        var _this = this;
        if (options === void 0) { options = { usage: 'search' }; }
        if (list == null)
            return null;
        if (keyNames == null || s == "" || Intl_support_1.IntlSupport.Collator(this.languageCode) == false)
            return new Observable_1.Observable(function (observer) {
                for (var _i = 0, list_3 = list; _i < list_3.length; _i++) {
                    var item = list_3[_i];
                    observer.next(item);
                }
                observer.complete();
            });
        return new Observable_1.Observable(function (observer) {
            // Gets the value of translation for the each column.
            var translated = new Array();
            var i = 0;
            for (var i = 0; i < keyNames.length; i++) {
                // Adds a new column for translated values.
                translated.push(keyNames[i].concat("Translated"));
                for (var _i = 0, list_4 = list; _i < list_4.length; _i++) {
                    var item = list_4[_i];
                    // Gets the values of translation for the column.
                    var value = _this.translate(item[keyNames[i]]);
                    // Updates the value in the list.
                    item[translated[i]] = value;
                }
            }
            var locale = _this.languageCode;
            // Intl.Collator.
            var collator = new Intl.Collator(locale, options);
            for (var _a = 0, list_5 = list; _a < list_5.length; _a++) {
                var v = list_5[_a];
                for (var i = 0; i < translated.length; i++) {
                    // Calls matching algorithm.
                    if (_this.match(v[translated[i]], s, collator)) {
                        observer.next(v);
                        break;
                    }
                }
            }
            // Removes the columns of translated values.
            for (var i = 0; i < translated.length; i++) {
                var index = list.indexOf(translated[i], 0);
                if (index > -1) {
                    list.splice(index, 1);
                }
            }
            ;
            observer.complete();
        });
    };
    LocalizationService.prototype.addExtension = function (locale, extension) {
        // Adds extension.
        if (extension != null && extension != "") {
            locale = locale + "-" + extension;
        }
        return locale;
    };
    /**
     * Matching algorithm.
     *
     * @param v The value
     * @param s The string to search
     * return True if match, otherwise false
     */
    LocalizationService.prototype.match = function (v, s, collator) {
        var vLength = v.length;
        var sLength = s.length;
        if (sLength > vLength)
            return false; // The search string is longer than value.
        if (sLength == vLength) {
            return collator.compare(v, s) === 0;
        }
        // Tries to search the substring.
        var found = false;
        for (var i = 0; i < vLength - (sLength - 1); i++) {
            var str = v.substr(i, sLength);
            if (collator.compare(str, s) === 0) {
                found = true;
                break;
            }
        }
        return found;
    };
    LocalizationService = __decorate([
        core_1.Injectable(), 
        __metadata('design:paramtypes', [http_1.Http, locale_service_1.LocaleService])
    ], LocalizationService);
    return LocalizationService;
}());
exports.LocalizationService = LocalizationService;
/**
 * Defines the service state.
 */
(function (ServiceState) {
    /**
     * The translation data has been loaded.
     */
    ServiceState[ServiceState["isReady"] = 0] = "isReady";
    /**
     * The service is loading the data.
     */
    ServiceState[ServiceState["isLoading"] = 1] = "isLoading";
    /**
     * The service is waiting for the data.
     */
    ServiceState[ServiceState["isWaiting"] = 2] = "isWaiting";
})(exports.ServiceState || (exports.ServiceState = {}));
var ServiceState = exports.ServiceState;
/**
 * Defines the loading mode.
 */
(function (LoadingMode) {
    /**
     * Initial state.
     */
    LoadingMode[LoadingMode["Unknown"] = 0] = "Unknown";
    /**
     * Direct loading.
     */
    LoadingMode[LoadingMode["Direct"] = 1] = "Direct";
    /**
     * Asynchronous loading.
     */
    LoadingMode[LoadingMode["Async"] = 2] = "Async";
})(exports.LoadingMode || (exports.LoadingMode = {}));
var LoadingMode = exports.LoadingMode;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9jYWxpemF0aW9uLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJsb2NhbGl6YXRpb24uc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7O0dBTUc7Ozs7Ozs7Ozs7O0FBRUgscUJBQXlCLGVBQWUsQ0FBQyxDQUFBO0FBQ3pDLHFCQUE2QixlQUFlLENBQUMsQ0FBQTtBQUU3QywyQkFBeUIsaUJBQWlCLENBQUMsQ0FBQTtBQUMzQyxRQUFPLHVCQUF1QixDQUFDLENBQUE7QUFFL0IsWUFBWTtBQUNaLCtCQUE0QixrQkFBa0IsQ0FBQyxDQUFBO0FBQy9DLDZCQUEwQixnQkFBZ0IsQ0FBQyxDQUFBO0FBRTNDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0FvQ0c7QUFDVztJQTJCViw2QkFBbUIsSUFBVSxFQUFTLE1BQXFCO1FBQXhDLFNBQUksR0FBSixJQUFJLENBQU07UUFBUyxXQUFNLEdBQU4sTUFBTSxDQUFlO1FBcEIzRDs7V0FFRztRQUNLLG9CQUFlLEdBQVEsRUFBRSxDQUFDO1FBbUI5QixJQUFJLENBQUMsTUFBTSxHQUFHLEVBQUUsQ0FBQztRQUNqQixJQUFJLENBQUMsV0FBVyxHQUFHLFdBQVcsQ0FBQyxPQUFPLENBQUM7UUFDdkMsSUFBSSxDQUFDLFlBQVksR0FBRyxFQUFFLENBQUM7UUFFdkIsZ0NBQWdDO1FBQ2hDLElBQUksQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFDLE1BQU0sQ0FBQztRQUV0QyxpQ0FBaUM7UUFDakMsSUFBSSxDQUFDLFlBQVksR0FBRyxZQUFZLENBQUMsU0FBUyxDQUFDO0lBRS9DLENBQUM7SUFFRDs7Ozs7T0FLRztJQUNILDRDQUFjLEdBQWQsVUFBZSxRQUFnQixFQUFFLFdBQWdCO1FBRTdDLGlDQUFpQztRQUNqQyxJQUFJLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQyxHQUFHLFdBQVcsQ0FBQztJQUVqRCxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILGlEQUFtQixHQUFuQixVQUFvQixNQUFjO1FBRTlCLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1FBRXJCLDRCQUE0QjtRQUM1QixJQUFJLENBQUMsV0FBVyxHQUFHLFdBQVcsQ0FBQyxLQUFLLENBQUM7SUFFekMsQ0FBQztJQUVEOztPQUVHO0lBQ0ssNENBQWMsR0FBdEI7UUFBQSxpQkF1Q0M7UUFyQ0csd0RBQXdEO1FBQ3hELElBQUksQ0FBQyxlQUFlLEdBQUcsRUFBRSxDQUFDO1FBQzFCLElBQUksQ0FBQyxZQUFZLEdBQUcsWUFBWSxDQUFDLFNBQVMsQ0FBQztRQUUzQyxJQUFJLEdBQUcsR0FBVyxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsa0JBQWtCLEVBQUUsR0FBRyxPQUFPLENBQUM7UUFFM0UseUJBQXlCO1FBQ3pCLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQzthQUNiLEdBQUcsQ0FBQyxVQUFDLEdBQWEsSUFBSyxPQUFBLEdBQUcsQ0FBQyxJQUFJLEVBQUUsRUFBVixDQUFVLENBQUM7YUFDbEMsU0FBUztRQUVWLG9CQUFvQjtRQUNwQixVQUFDLEdBQVE7WUFFTCxnREFBZ0Q7WUFDaEQsS0FBSSxDQUFDLGVBQWUsQ0FBQyxLQUFJLENBQUMsTUFBTSxDQUFDLGtCQUFrQixFQUFFLENBQUMsR0FBRyxHQUFHLENBQUM7UUFFakUsQ0FBQztRQUVELFNBQVM7UUFDVCxVQUFDLEtBQVU7WUFFUCxPQUFPLENBQUMsS0FBSyxDQUFDLHVCQUF1QixFQUFFLEtBQUssQ0FBQyxDQUFDO1FBRWxELENBQUM7UUFFRCxZQUFZO1FBQ1o7WUFFSSw0Q0FBNEM7WUFDNUMsS0FBSSxDQUFDLFlBQVksR0FBRyxLQUFJLENBQUMsTUFBTSxDQUFDLGtCQUFrQixFQUFFLENBQUM7WUFFckQsNkJBQTZCO1lBQzdCLEtBQUksQ0FBQyxZQUFZLEdBQUcsWUFBWSxDQUFDLE9BQU8sQ0FBQztRQUU3QyxDQUFDLENBQUMsQ0FBQztJQUVYLENBQUM7SUFFRDs7Ozs7T0FLRztJQUNILHVDQUFTLEdBQVQsVUFBVSxHQUFXO1FBRWpCLElBQUksS0FBYSxDQUFDO1FBRWxCLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUM7WUFFbEQsMENBQTBDO1lBQzFDLElBQUksV0FBVyxHQUFRLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQy9ELDJDQUEyQztZQUMzQyxLQUFLLEdBQUcsV0FBVyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBRTdCLENBQUM7UUFFRCx1RkFBdUY7UUFDdkYsRUFBRSxDQUFDLENBQUMsS0FBSyxJQUFJLElBQUksSUFBSSxLQUFLLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQztZQUUvQixLQUFLLEdBQUcsR0FBRyxDQUFDO1FBRWhCLENBQUM7UUFFRCxNQUFNLENBQUMsS0FBSyxDQUFDO0lBRWpCLENBQUM7SUFFRDs7Ozs7T0FLRztJQUNILDRDQUFjLEdBQWQsVUFBZSxHQUFXO1FBQTFCLGlCQVlDO1FBVkcsTUFBTSxDQUFDLElBQUksdUJBQVUsQ0FBUyxVQUFDLFFBQTBCO1lBRXJELDZDQUE2QztZQUM3QyxJQUFJLEtBQUssR0FBVyxLQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBRXhDLFFBQVEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDckIsUUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBRXhCLENBQUMsQ0FBQyxDQUFDO0lBRVAsQ0FBQztJQUVEOztPQUVHO0lBQ0gsK0NBQWlCLEdBQWpCO1FBRUksRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxrQkFBa0IsRUFBRSxJQUFJLEVBQUUsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLGtCQUFrQixFQUFFLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7WUFFbEcsd0JBQXdCO1lBQ3hCLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLElBQUksV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7Z0JBRXhDLGtDQUFrQztnQkFDbEMsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1lBRTFCLENBQUM7WUFBQyxJQUFJLENBQUMsQ0FBQztnQkFFSiw0Q0FBNEM7Z0JBQzVDLElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO2dCQUVyRCw2QkFBNkI7Z0JBQzdCLElBQUksQ0FBQyxZQUFZLEdBQUcsWUFBWSxDQUFDLE9BQU8sQ0FBQztZQUU3QyxDQUFDO1FBRUwsQ0FBQztJQUVMLENBQUM7SUFFRCxtQkFBbUI7SUFFbkI7Ozs7Ozs7O09BUUc7SUFDSCxxQ0FBTyxHQUFQLFVBQVEsSUFBWSxFQUFFLElBQVksRUFBRSxTQUFrQixFQUFFLE9BQWE7UUFFakUsK0JBQStCO1FBQy9CLEVBQUUsQ0FBQyxDQUFDLDBCQUFXLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBRW5ELE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFFYixDQUFDO1FBRUQsOENBQThDO1FBQzlDLElBQUksTUFBTSxHQUFXLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDMUMsSUFBSSxNQUFNLEdBQVcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUFBLENBQUM7UUFFM0MsSUFBSSxNQUFNLEdBQVcsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLFNBQVMsQ0FBQyxDQUFDO1FBRXJFLE1BQU0sQ0FBQyxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxNQUFNLENBQUMsQ0FBQztJQUU3RCxDQUFDO0lBRUQ7Ozs7Ozs7Ozs7T0FVRztJQUNILGtDQUFJLEdBQUosVUFBSyxJQUFnQixFQUFFLE9BQVksRUFBRSxLQUFjLEVBQUUsU0FBa0IsRUFBRSxPQUFhO1FBRWxGLEVBQUUsQ0FBQyxDQUFDLElBQUksSUFBSSxJQUFJLElBQUksT0FBTyxJQUFJLElBQUksSUFBSSwwQkFBVyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksS0FBSyxDQUFDO1lBQUMsTUFBTSxDQUFDLElBQUksQ0FBQztRQUVyRyw4Q0FBOEM7UUFDOUMsR0FBRyxDQUFDLENBQWEsVUFBSSxFQUFKLGFBQUksRUFBSixrQkFBSSxFQUFKLElBQUksQ0FBQztZQUFqQixJQUFJLElBQUksYUFBQTtZQUVULDZDQUE2QztZQUM3QyxJQUFJLEtBQUssR0FBVyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBQ2xELDJDQUEyQztZQUMzQyxJQUFJLFVBQVUsR0FBVyxPQUFPLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFBO1lBQ3JELGlDQUFpQztZQUNqQyxJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsS0FBSyxDQUFDO1NBRTVCO1FBRUQsSUFBSSxNQUFNLEdBQVcsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLFNBQVMsQ0FBQyxDQUFDO1FBRXJFLGlCQUFpQjtRQUNqQixJQUFJLFFBQVEsR0FBRyxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUMscURBQXFEO1FBRXhHLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBQyxDQUFDLEVBQUUsQ0FBQztZQUVYLE1BQU0sQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztRQUUxRCxDQUFDLENBQUMsQ0FBQztRQUVILDJDQUEyQztRQUMzQyxJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUN4QyxFQUFFLENBQUMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDMUIsQ0FBQztRQUVELG9CQUFvQjtRQUNwQixFQUFFLENBQUMsQ0FBQyxLQUFLLElBQUksSUFBSSxJQUFJLEtBQUssSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDO1lBRW5DLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUVuQixDQUFDO1FBRUQsTUFBTSxDQUFDLElBQUksQ0FBQztJQUVoQixDQUFDO0lBRUQ7Ozs7Ozs7Ozs7T0FVRztJQUNILHVDQUFTLEdBQVQsVUFBVSxJQUFnQixFQUFFLE9BQVksRUFBRSxLQUFjLEVBQUUsU0FBa0IsRUFBRSxPQUFhO1FBQTNGLGlCQVVDO1FBUkcsTUFBTSxDQUFDLElBQUksdUJBQVUsQ0FBTSxVQUFDLFFBQThCO1lBRXRELHdCQUF3QjtZQUN4QixRQUFRLENBQUMsSUFBSSxDQUFDLEtBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUM7WUFDbkUsUUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBRXhCLENBQUMsQ0FBQyxDQUFDO0lBRVAsQ0FBQztJQUVEOzs7Ozs7Ozs7T0FTRztJQUNILG9DQUFNLEdBQU4sVUFBTyxDQUFTLEVBQUUsSUFBZ0IsRUFBRSxRQUFlLEVBQUUsT0FBa0M7UUFBdkYsaUJBNERDO1FBNURvRCx1QkFBa0MsR0FBbEMsWUFBaUIsS0FBSyxFQUFFLFFBQVEsRUFBRTtRQUVuRixFQUFFLENBQUMsQ0FBQyxJQUFJLElBQUksSUFBSSxJQUFJLFFBQVEsSUFBSSxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSwwQkFBVyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksS0FBSyxDQUFDO1lBQUMsTUFBTSxDQUFDLElBQUksQ0FBQztRQUVqSCxxREFBcUQ7UUFDckQsSUFBSSxVQUFVLEdBQUcsSUFBSSxLQUFLLEVBQVUsQ0FBQztRQUVyQyxJQUFJLENBQUMsR0FBVyxDQUFDLENBQUM7UUFDbEIsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQVcsQ0FBQyxFQUFFLENBQUMsR0FBRyxRQUFRLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7WUFFL0MsMkNBQTJDO1lBQzNDLFVBQVUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO1lBRWxELEdBQUcsQ0FBQyxDQUFhLFVBQUksRUFBSixhQUFJLEVBQUosa0JBQUksRUFBSixJQUFJLENBQUM7Z0JBQWpCLElBQUksSUFBSSxhQUFBO2dCQUVULGlEQUFpRDtnQkFDakQsSUFBSSxLQUFLLEdBQVcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDdEQsaUNBQWlDO2dCQUNqQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFDO2FBRS9CO1FBRUwsQ0FBQztRQUVELElBQUksTUFBTSxHQUFXLElBQUksQ0FBQyxZQUFZLENBQUM7UUFFdkMsaUJBQWlCO1FBQ2pCLElBQUksUUFBUSxHQUFHLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFFbEQsSUFBSSxPQUFPLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFDLENBQUM7WUFFeEIsSUFBSSxLQUFLLEdBQVksS0FBSyxDQUFDO1lBQzNCLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFXLENBQUMsRUFBRSxDQUFDLEdBQUcsVUFBVSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO2dCQUVqRCw0QkFBNEI7Z0JBQzVCLEVBQUUsQ0FBQyxDQUFDLEtBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBRTVDLEtBQUssR0FBRyxJQUFJLENBQUM7b0JBQ2IsS0FBSyxDQUFDO2dCQUVWLENBQUM7WUFFTCxDQUFDO1lBRUQsTUFBTSxDQUFDLEtBQUssQ0FBQztRQUVqQixDQUFDLENBQUMsQ0FBQztRQUVILDRDQUE0QztRQUM1QyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBVyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFVBQVUsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUVqRCxJQUFJLEtBQUssR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUM5QyxFQUFFLENBQUMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNiLE9BQU8sQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQzdCLENBQUM7UUFFTCxDQUFDO1FBRUQsTUFBTSxDQUFDLE9BQU8sQ0FBQztJQUVuQixDQUFDO0lBRUQ7Ozs7Ozs7OztPQVNHO0lBQ0gseUNBQVcsR0FBWCxVQUFZLENBQVMsRUFBRSxJQUFnQixFQUFFLFFBQWUsRUFBRSxPQUFrQztRQUE1RixpQkF5RUM7UUF6RXlELHVCQUFrQyxHQUFsQyxZQUFpQixLQUFLLEVBQUUsUUFBUSxFQUFFO1FBRXhGLEVBQUUsQ0FBQyxDQUFDLElBQUksSUFBSSxJQUFJLENBQUM7WUFBQyxNQUFNLENBQUMsSUFBSSxDQUFDO1FBRTlCLEVBQUUsQ0FBQyxDQUFDLFFBQVEsSUFBSSxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSwwQkFBVyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksS0FBSyxDQUFDO1lBQUMsTUFBTSxDQUFDLElBQUksdUJBQVUsQ0FBTSxVQUFDLFFBQXVCO2dCQUVwSSxHQUFHLENBQUMsQ0FBYSxVQUFJLEVBQUosYUFBSSxFQUFKLGtCQUFJLEVBQUosSUFBSSxDQUFDO29CQUFqQixJQUFJLElBQUksYUFBQTtvQkFFVCxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO2lCQUV2QjtnQkFFRCxRQUFRLENBQUMsUUFBUSxFQUFFLENBQUM7WUFFeEIsQ0FBQyxDQUFDLENBQUM7UUFFSCxNQUFNLENBQUMsSUFBSSx1QkFBVSxDQUFNLFVBQUMsUUFBdUI7WUFFL0MscURBQXFEO1lBQ3JELElBQUksVUFBVSxHQUFHLElBQUksS0FBSyxFQUFVLENBQUM7WUFFckMsSUFBSSxDQUFDLEdBQVcsQ0FBQyxDQUFDO1lBQ2xCLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFXLENBQUMsRUFBRSxDQUFDLEdBQUcsUUFBUSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO2dCQUUvQywyQ0FBMkM7Z0JBQzNDLFVBQVUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO2dCQUVsRCxHQUFHLENBQUMsQ0FBYSxVQUFJLEVBQUosYUFBSSxFQUFKLGtCQUFJLEVBQUosSUFBSSxDQUFDO29CQUFqQixJQUFJLElBQUksYUFBQTtvQkFFVCxpREFBaUQ7b0JBQ2pELElBQUksS0FBSyxHQUFXLEtBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQ3RELGlDQUFpQztvQkFDakMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQztpQkFFL0I7WUFFTCxDQUFDO1lBRUQsSUFBSSxNQUFNLEdBQVcsS0FBSSxDQUFDLFlBQVksQ0FBQztZQUV2QyxpQkFBaUI7WUFDakIsSUFBSSxRQUFRLEdBQUcsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQztZQUVsRCxHQUFHLENBQUMsQ0FBVSxVQUFJLEVBQUosYUFBSSxFQUFKLGtCQUFJLEVBQUosSUFBSSxDQUFDO2dCQUFkLElBQUksQ0FBQyxhQUFBO2dCQUVOLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFXLENBQUMsRUFBRSxDQUFDLEdBQUcsVUFBVSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO29CQUVqRCw0QkFBNEI7b0JBQzVCLEVBQUUsQ0FBQyxDQUFDLEtBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7d0JBRTVDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7d0JBQ2pCLEtBQUssQ0FBQztvQkFFVixDQUFDO2dCQUVMLENBQUM7YUFFSjtZQUVELDRDQUE0QztZQUM1QyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBVyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFVBQVUsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztnQkFFakQsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7Z0JBQzNDLEVBQUUsQ0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQ2IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7Z0JBQzFCLENBQUM7WUFFTCxDQUFDO1lBQUEsQ0FBQztZQUVGLFFBQVEsQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUV4QixDQUFDLENBQUMsQ0FBQztJQUVQLENBQUM7SUFFTywwQ0FBWSxHQUFwQixVQUFxQixNQUFjLEVBQUUsU0FBa0I7UUFFbkQsa0JBQWtCO1FBQ2xCLEVBQUUsQ0FBQyxDQUFDLFNBQVMsSUFBSSxJQUFJLElBQUksU0FBUyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFFdkMsTUFBTSxHQUFHLE1BQU0sR0FBRyxHQUFHLEdBQUcsU0FBUyxDQUFDO1FBRXRDLENBQUM7UUFFRCxNQUFNLENBQUMsTUFBTSxDQUFDO0lBRWxCLENBQUM7SUFFRDs7Ozs7O09BTUc7SUFDSyxtQ0FBSyxHQUFiLFVBQWMsQ0FBUyxFQUFFLENBQVMsRUFBRSxRQUF1QjtRQUV2RCxJQUFJLE9BQU8sR0FBVyxDQUFDLENBQUMsTUFBTSxDQUFDO1FBQy9CLElBQUksT0FBTyxHQUFXLENBQUMsQ0FBQyxNQUFNLENBQUM7UUFFL0IsRUFBRSxDQUFDLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztZQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQywwQ0FBMEM7UUFFL0UsRUFBRSxDQUFDLENBQUMsT0FBTyxJQUFJLE9BQU8sQ0FBQyxDQUFDLENBQUM7WUFFckIsTUFBTSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUV4QyxDQUFDO1FBRUQsaUNBQWlDO1FBQ2pDLElBQUksS0FBSyxHQUFZLEtBQUssQ0FBQztRQUMzQixHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBVyxDQUFDLEVBQUUsQ0FBQyxHQUFHLE9BQU8sR0FBRyxDQUFDLE9BQU8sR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBRXZELElBQUksR0FBRyxHQUFXLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1lBQ3ZDLEVBQUUsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBRWpDLEtBQUssR0FBRyxJQUFJLENBQUM7Z0JBQ2IsS0FBSyxDQUFDO1lBRVYsQ0FBQztRQUVMLENBQUM7UUFFRCxNQUFNLENBQUMsS0FBSyxDQUFDO0lBRWpCLENBQUM7SUF2Zkw7UUFBQyxpQkFBVSxFQUFFOzsyQkFBQTtJQXlmYiwwQkFBQztBQUFELENBQUMsQUF6ZmEsSUF5ZmI7QUF6ZjBCLDJCQUFtQixzQkF5ZjdDLENBQUE7QUFFRDs7R0FFRztBQUNILFdBQVksWUFBWTtJQUVwQjs7T0FFRztJQUNILHFEQUFPLENBQUE7SUFDUDs7T0FFRztJQUNILHlEQUFTLENBQUE7SUFDVDs7T0FFRztJQUNILHlEQUFTLENBQUE7QUFFYixDQUFDLEVBZlcsb0JBQVksS0FBWixvQkFBWSxRQWV2QjtBQWZELElBQVksWUFBWSxHQUFaLG9CQWVYLENBQUE7QUFFRDs7R0FFRztBQUNILFdBQVksV0FBVztJQUVuQjs7T0FFRztJQUNILG1EQUFPLENBQUE7SUFDUDs7T0FFRztJQUNILGlEQUFNLENBQUE7SUFDTjs7T0FFRztJQUNILCtDQUFLLENBQUE7QUFFVCxDQUFDLEVBZlcsbUJBQVcsS0FBWCxtQkFBVyxRQWV0QjtBQWZELElBQVksV0FBVyxHQUFYLG1CQWVYLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQU5HVUxBUiAyIExPQ0FMSVpBVElPTlxyXG4gKiBBbiBBbmd1bGFyIDIgbGlicmFyeSB0byB0cmFuc2xhdGUgbWVzc2FnZXMsIGRhdGVzIGFuZCBudW1iZXJzLlxyXG4gKiBXcml0dGVuIGJ5IFJvYmVydG8gU2ltb25ldHRpLlxyXG4gKiBNSVQgbGljZW5zZS5cclxuICogaHR0cHM6Ly9naXRodWIuY29tL3JvYmlzaW03NC9hbmd1bGFyMmxvY2FsaXphdGlvblxyXG4gKi9cclxuXHJcbmltcG9ydCB7SW5qZWN0YWJsZX0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7SHR0cCwgUmVzcG9uc2V9IGZyb20gJ0Bhbmd1bGFyL2h0dHAnO1xyXG5pbXBvcnQge09ic2VydmVyfSBmcm9tICdyeGpzL09ic2VydmVyJztcclxuaW1wb3J0IHtPYnNlcnZhYmxlfSBmcm9tICdyeGpzL09ic2VydmFibGUnO1xyXG5pbXBvcnQgJ3J4anMvYWRkL29wZXJhdG9yL21hcCc7XHJcblxyXG4vLyBTZXJ2aWNlcy5cclxuaW1wb3J0IHtMb2NhbGVTZXJ2aWNlfSBmcm9tICcuL2xvY2FsZS5zZXJ2aWNlJztcclxuaW1wb3J0IHtJbnRsU3VwcG9ydH0gZnJvbSAnLi9JbnRsLXN1cHBvcnQnO1xyXG5cclxuLyoqXHJcbiAqIExvY2FsaXphdGlvblNlcnZpY2UgY2xhc3MuXHJcbiAqIFxyXG4gKiBEaXJlY3QgbG9hZGluZy5cclxuICogXHJcbiAqIFRvIGluaXRpYWxpemUgTG9jYWxpemF0aW9uU2VydmljZSBmb3IgdGhlIGRpcmVjdCBsb2FkaW5nLCBhZGQgdGhlIGZvbGxvd2luZyBjb2RlIGluIHRoZSBib2R5IG9mIGNvbnN0cnVjdG9yIG9mIHRoZSByb3V0ZSBjb21wb25lbnQ6XHJcbiAqXHJcbiAqIHZhciB0cmFuc2xhdGlvbkVOID0ge1xyXG4gKiAgICAgIFRJVExFOiAnQW5ndWxhciAyIExvY2FsaXphdGlvbicsXHJcbiAqICAgICAgQ0hBTkdFX0xBTkdVQUdFOiAnQ2hhbmdlIGxhbmd1YWdlJyxcclxuICogICAgICAuLi5cclxuICogfVxyXG4gKiAvLyBBZGQgYSBuZXcgdHJhbnNsYXRpb24gaGVyZS5cclxuICogXHJcbiAqIC8vIFJlcXVpcmVkOiBhZGRzIGEgbmV3IHRyYW5zbGF0aW9uIHdpdGggdGhlIGdpdmVuIGxhbmd1YWdlIGNvZGUuXHJcbiAqIHRoaXMubG9jYWxpemF0aW9uLmFkZFRyYW5zbGF0aW9uKCdlbicsIHRyYW5zbGF0aW9uRU4pO1xyXG4gKiAvLyBBZGQgYSBuZXcgdHJhbnNsYXRpb24gd2l0aCB0aGUgZ2l2ZW4gbGFuZ3VhZ2UgY29kZSBoZXJlLlxyXG4gKiB0aGlzLmxvY2FsaXphdGlvbi51cGRhdGVUcmFuc2xhdGlvbigpOyAvLyBOZWVkIHRvIHVwZGF0ZSB0aGUgdHJhbnNsYXRpb24uXHJcbiAqIFxyXG4gKiBBc3luY2hyb25vdXMgbG9hZGluZy5cclxuICogXHJcbiAqIFRvIGluaXRpYWxpemUgTG9jYWxpemF0aW9uU2VydmljZSBmb3IgdGhlIGFzeW5jaHJvbm91cyBsb2FkaW5nLCBhZGQgdGhlIGZvbGxvd2luZyBjb2RlIGluIHRoZSBib2R5IG9mIGNvbnN0cnVjdG9yIG9mIHRoZSByb3V0ZSBjb21wb25lbnQ6XHJcbiAqIFxyXG4gKiAvLyBSZXF1aXJlZDogaW5pdGlhbGl6ZXMgdGhlIHRyYW5zbGF0aW9uIHByb3ZpZGVyIHdpdGggdGhlIGdpdmVuIHBhdGggcHJlZml4LlxyXG4gKiB0aGlzLmxvY2FsaXphdGlvbi50cmFuc2xhdGlvblByb3ZpZGVyKCcuL3Jlc291cmNlcy9sb2NhbGUtJyk7XHJcbiAqIHRoaXMubG9jYWxpemF0aW9uLnVwZGF0ZVRyYW5zbGF0aW9uKCk7IC8vIE5lZWQgdG8gdXBkYXRlIHRoZSB0cmFuc2xhdGlvbi5cclxuICogXHJcbiAqIGFuZCBjcmVhdGUgdGhlIGpzb24gZmlsZXMgb2YgdGhlIHRyYW5zbGF0aW9ucyBzdWNoIGFzICdsb2NhbGUtZW4uanNvbic6XHJcbiAqIFxyXG4gKiB7XHJcbiAqICAgICBcIlRJVExFXCI6IFwiQW5ndWxhciAyIExvY2FsaXphdGlvblwiLFxyXG4gKiAgICAgXCJDSEFOR0VfTEFOR1VBR0VcIjogXCJDaGFuZ2UgbGFuZ3VhZ2VcIixcclxuICogICAgIC4uLlxyXG4gKiB9XHJcbiAqIFxyXG4gKiBAYXV0aG9yIFJvYmVydG8gU2ltb25ldHRpXHJcbiAqL1xyXG5ASW5qZWN0YWJsZSgpIGV4cG9ydCBjbGFzcyBMb2NhbGl6YXRpb25TZXJ2aWNlIHtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFRoZSBwYXRoIHByZWZpeCBmb3IgdGhlIGFzeW5jaHJvbm91cyBsb2FkaW5nLlxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIHByZWZpeDogc3RyaW5nO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogVGhlIHRyYW5zbGF0aW9uIGRhdGE6IHtsYW5ndWFnZUNvZGU6IHtrZXk6IHZhbHVlfX0uXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgdHJhbnNsYXRpb25EYXRhOiBhbnkgPSB7fTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFRoZSBsYW5ndWFnZSBjb2RlIGZvciB0aGUgc2VydmljZS5cclxuICAgICAqL1xyXG4gICAgcHVibGljIGxhbmd1YWdlQ29kZTogc3RyaW5nO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogVGhlIGxvYWRpbmcgbW9kZSBmb3IgdGhlIHNlcnZpY2UuXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBsb2FkaW5nTW9kZTogTG9hZGluZ01vZGU7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBUaGUgc2VydmljZSBzdGF0ZS4gXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzZXJ2aWNlU3RhdGU6IFNlcnZpY2VTdGF0ZTtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgaHR0cDogSHR0cCwgcHVibGljIGxvY2FsZTogTG9jYWxlU2VydmljZSkge1xyXG5cclxuICAgICAgICB0aGlzLnByZWZpeCA9IFwiXCI7XHJcbiAgICAgICAgdGhpcy5sb2FkaW5nTW9kZSA9IExvYWRpbmdNb2RlLlVua25vd247XHJcbiAgICAgICAgdGhpcy5sYW5ndWFnZUNvZGUgPSBcIlwiO1xyXG5cclxuICAgICAgICAvLyBJbml0aWFsaXplcyB0aGUgbG9hZGluZyBtb2RlLlxyXG4gICAgICAgIHRoaXMubG9hZGluZ01vZGUgPSBMb2FkaW5nTW9kZS5EaXJlY3Q7XHJcblxyXG4gICAgICAgIC8vIEluaXRpYWxpemVzIHRoZSBzZXJ2aWNlIHN0YXRlLlxyXG4gICAgICAgIHRoaXMuc2VydmljZVN0YXRlID0gU2VydmljZVN0YXRlLmlzV2FpdGluZztcclxuXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBEaXJlY3QgbG9hZGluZzogYWRkcyBuZXcgdHJhbnNsYXRpb24gZGF0YS5cclxuICAgICAqIFxyXG4gICAgICogQHBhcmFtIGxhbmd1YWdlIFRoZSB0d28tbGV0dGVyIGNvZGUgb2YgdGhlIGxhbmd1YWdlIGZvciB0aGUgdHJhbnNsYXRpb24gZGF0YVxyXG4gICAgICogQHBhcmFtIHRyYW5zbGF0aW9uIFRoZSBuZXcgdHJhbnNsYXRpb24gZGF0YVxyXG4gICAgICovXHJcbiAgICBhZGRUcmFuc2xhdGlvbihsYW5ndWFnZTogc3RyaW5nLCB0cmFuc2xhdGlvbjogYW55KSB7XHJcblxyXG4gICAgICAgIC8vIEFkZHMgdGhlIG5ldyB0cmFuc2xhdGlvbiBkYXRhLlxyXG4gICAgICAgIHRoaXMudHJhbnNsYXRpb25EYXRhW2xhbmd1YWdlXSA9IHRyYW5zbGF0aW9uO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEFzeW5jaHJvbm91cyBsb2FkaW5nOiBkZWZpbmVzIHRoZSB0cmFuc2xhdGlvbiBwcm92aWRlci5cclxuICAgICAqIFxyXG4gICAgICogQHBhcmFtIHByZWZpeCBUaGUgcGF0aCBwcmVmaXggb2YgdGhlIGpzb24gZmlsZXNcclxuICAgICAqL1xyXG4gICAgdHJhbnNsYXRpb25Qcm92aWRlcihwcmVmaXg6IHN0cmluZykge1xyXG5cclxuICAgICAgICB0aGlzLnByZWZpeCA9IHByZWZpeDtcclxuXHJcbiAgICAgICAgLy8gVXBkYXRlcyB0aGUgbG9hZGluZyBtb2RlLlxyXG4gICAgICAgIHRoaXMubG9hZGluZ01vZGUgPSBMb2FkaW5nTW9kZS5Bc3luYztcclxuXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBHZXRzIHRoZSBqc29uIGRhdGEuXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgZ2V0VHJhbnNsYXRpb24oKSB7XHJcblxyXG4gICAgICAgIC8vIEluaXRpYWxpemVzIHRoZSB0cmFuc2xhdGlvbiBkYXRhICYgdGhlIHNlcnZpY2Ugc3RhdGUuXHJcbiAgICAgICAgdGhpcy50cmFuc2xhdGlvbkRhdGEgPSB7fTtcclxuICAgICAgICB0aGlzLnNlcnZpY2VTdGF0ZSA9IFNlcnZpY2VTdGF0ZS5pc0xvYWRpbmc7XHJcblxyXG4gICAgICAgIHZhciB1cmw6IHN0cmluZyA9IHRoaXMucHJlZml4ICsgdGhpcy5sb2NhbGUuZ2V0Q3VycmVudExhbmd1YWdlKCkgKyAnLmpzb24nO1xyXG5cclxuICAgICAgICAvLyBBbmd1bGFyIDIgSHR0cCBtb2R1bGUuXHJcbiAgICAgICAgdGhpcy5odHRwLmdldCh1cmwpXHJcbiAgICAgICAgICAgIC5tYXAoKHJlczogUmVzcG9uc2UpID0+IHJlcy5qc29uKCkpXHJcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoXHJcblxyXG4gICAgICAgICAgICAvLyBPYnNlcnZlciBvciBuZXh0LlxyXG4gICAgICAgICAgICAocmVzOiBhbnkpID0+IHtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBBc3NpZ25zIHRoZSBvYnNlcnZlciB0byB0aGUgdHJhbnNsYXRpb24gZGF0YS5cclxuICAgICAgICAgICAgICAgIHRoaXMudHJhbnNsYXRpb25EYXRhW3RoaXMubG9jYWxlLmdldEN1cnJlbnRMYW5ndWFnZSgpXSA9IHJlcztcclxuXHJcbiAgICAgICAgICAgIH0sXHJcblxyXG4gICAgICAgICAgICAvLyBFcnJvci5cclxuICAgICAgICAgICAgKGVycm9yOiBhbnkpID0+IHtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiTG9jYWxpemF0aW9uIHNlcnZpY2U6XCIsIGVycm9yKTtcclxuXHJcbiAgICAgICAgICAgIH0sXHJcblxyXG4gICAgICAgICAgICAvLyBDb21wbGV0ZS5cclxuICAgICAgICAgICAgKCkgPT4ge1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIFVwZGF0ZXMgdGhlIGxhbmd1YWdlIGNvZGUgb2YgdGhlIHNlcnZpY2UuXHJcbiAgICAgICAgICAgICAgICB0aGlzLmxhbmd1YWdlQ29kZSA9IHRoaXMubG9jYWxlLmdldEN1cnJlbnRMYW5ndWFnZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIFVwZGF0ZXMgdGhlIHNlcnZpY2Ugc3RhdGUuXHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlcnZpY2VTdGF0ZSA9IFNlcnZpY2VTdGF0ZS5pc1JlYWR5O1xyXG5cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogVHJhbnNsYXRlcyBhIGtleS5cclxuICAgICAqIFxyXG4gICAgICogQHBhcmFtIGtleSBUaGUga2V5IHRvIGJlIHRyYW5zbGF0ZWRcclxuICAgICAqIEByZXR1cm4gVGhlIHZhbHVlIG9mIHRyYW5zbGF0aW9uXHJcbiAgICAgKi9cclxuICAgIHRyYW5zbGF0ZShrZXk6IHN0cmluZyk6IHN0cmluZyB7XHJcblxyXG4gICAgICAgIHZhciB2YWx1ZTogc3RyaW5nO1xyXG5cclxuICAgICAgICBpZiAodGhpcy50cmFuc2xhdGlvbkRhdGFbdGhpcy5sYW5ndWFnZUNvZGVdICE9IG51bGwpIHtcclxuXHJcbiAgICAgICAgICAgIC8vIEdldHMgdGhlIHRyYW5zbGF0aW9uIGJ5IGxhbmd1YWdlIGNvZGUuIFxyXG4gICAgICAgICAgICB2YXIgdHJhbnNsYXRpb246IGFueSA9IHRoaXMudHJhbnNsYXRpb25EYXRhW3RoaXMubGFuZ3VhZ2VDb2RlXTtcclxuICAgICAgICAgICAgLy8gR2V0cyB0aGUgdmFsdWUgb2YgdHJhbnNsYXRpb24gYnkga2V5LiAgIFxyXG4gICAgICAgICAgICB2YWx1ZSA9IHRyYW5zbGF0aW9uW2tleV07XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gSWYgdGhlIHZhbHVlIG9mIHRyYW5zbGF0aW9uIGlzIG5vdCBwcmVzZW50LCB0aGUgc2FtZSBrZXkgaXMgcmV0dXJuZWQgKHNlZSBpc3N1ZSAjMSkuXHJcbiAgICAgICAgaWYgKHZhbHVlID09IG51bGwgfHwgdmFsdWUgPT0gXCJcIikge1xyXG5cclxuICAgICAgICAgICAgdmFsdWUgPSBrZXk7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFRyYW5zbGF0ZXMgYSBrZXkuXHJcbiAgICAgKiBcclxuICAgICAqIEBwYXJhbSBrZXkgVGhlIGtleSB0byBiZSB0cmFuc2xhdGVkXHJcbiAgICAgKiBAcmV0dXJuIEFuIG9ic2VydmFibGUgb2YgdGhlIHZhbHVlIG9mIHRyYW5zbGF0aW9uXHJcbiAgICAgKi9cclxuICAgIHRyYW5zbGF0ZUFzeW5jKGtleTogc3RyaW5nKTogT2JzZXJ2YWJsZTxzdHJpbmc+IHtcclxuXHJcbiAgICAgICAgcmV0dXJuIG5ldyBPYnNlcnZhYmxlPHN0cmluZz4oKG9ic2VydmVyOiBPYnNlcnZlcjxzdHJpbmc+KSA9PiB7XHJcblxyXG4gICAgICAgICAgICAvLyBHZXRzIHRoZSB2YWx1ZSBvZiB0cmFuc2xhdGlvbiBmb3IgdGhlIGtleS5cclxuICAgICAgICAgICAgdmFyIHZhbHVlOiBzdHJpbmcgPSB0aGlzLnRyYW5zbGF0ZShrZXkpO1xyXG5cclxuICAgICAgICAgICAgb2JzZXJ2ZXIubmV4dCh2YWx1ZSk7XHJcbiAgICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XHJcblxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFVwZGF0ZXMgdGhlIGxhbmd1YWdlIGNvZGUgYW5kIGxvYWRzIHRoZSB0cmFuc2xhdGlvbiBkYXRhIGZvciB0aGUgYXN5bmNocm9ub3VzIGxvYWRpbmcuXHJcbiAgICAgKi9cclxuICAgIHVwZGF0ZVRyYW5zbGF0aW9uKCkge1xyXG5cclxuICAgICAgICBpZiAodGhpcy5sb2NhbGUuZ2V0Q3VycmVudExhbmd1YWdlKCkgIT0gXCJcIiAmJiB0aGlzLmxvY2FsZS5nZXRDdXJyZW50TGFuZ3VhZ2UoKSAhPSB0aGlzLmxhbmd1YWdlQ29kZSkge1xyXG5cclxuICAgICAgICAgICAgLy8gQXN5bmNocm9ub3VzIGxvYWRpbmcuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmxvYWRpbmdNb2RlID09IExvYWRpbmdNb2RlLkFzeW5jKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gVXBkYXRlcyB0aGUgdHJhbnNsYXRpb24gZGF0YS4gIFxyXG4gICAgICAgICAgICAgICAgdGhpcy5nZXRUcmFuc2xhdGlvbigpO1xyXG5cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBVcGRhdGVzIHRoZSBsYW5ndWFnZSBjb2RlIG9mIHRoZSBzZXJ2aWNlLlxyXG4gICAgICAgICAgICAgICAgdGhpcy5sYW5ndWFnZUNvZGUgPSB0aGlzLmxvY2FsZS5nZXRDdXJyZW50TGFuZ3VhZ2UoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBVcGRhdGVzIHRoZSBzZXJ2aWNlIHN0YXRlLlxyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXJ2aWNlU3RhdGUgPSBTZXJ2aWNlU3RhdGUuaXNSZWFkeTtcclxuXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICAvKiBJbnRsLkNvbGxhdG9yICovXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDb21wYXJlcyB0d28ga2V5cyBieSB0aGUgdmFsdWUgb2YgdHJhbnNsYXRpb24gJiB0aGUgY3VycmVudCBsYW5ndWFnZSBjb2RlLlxyXG4gICAgICogXHJcbiAgICAgKiBAcGFyYW0ga2V5MSwga2V5MiBUaGUga2V5cyBvZiB0aGUgdmFsdWVzIHRvIGNvbXBhcmVcclxuICAgICAqIEBwYXJhbSBleHRlbnNpb25cclxuICAgICAqIEBwYXJhbSBvcHRpb25zXHJcbiAgICAgKiBAcmV0dXJuIEEgbmVnYXRpdmUgdmFsdWUgaWYgdGhlIHZhbHVlIG9mIHRyYW5zbGF0aW9uIG9mIGtleTEgY29tZXMgYmVmb3JlIHRoZSB2YWx1ZSBvZiB0cmFuc2xhdGlvbiBvZiBrZXkyOyBhIHBvc2l0aXZlIHZhbHVlIGlmIGtleTEgY29tZXMgYWZ0ZXIga2V5MjsgMCBpZiB0aGV5IGFyZSBjb25zaWRlcmVkIGVxdWFsIG9yIEludGwuQ29sbGF0b3IgaXMgbm90IHN1cHBvcnRlZFxyXG4gICAgICogQHNlZSBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9HbG9iYWxfT2JqZWN0cy9Db2xsYXRvclxyXG4gICAgICovXHJcbiAgICBjb21wYXJlKGtleTE6IHN0cmluZywga2V5Mjogc3RyaW5nLCBleHRlbnNpb24/OiBzdHJpbmcsIG9wdGlvbnM/OiBhbnkpOiBudW1iZXIge1xyXG5cclxuICAgICAgICAvLyBDaGVja3MgZm9yIHN1cHBvcnQgZm9yIEludGwuXHJcbiAgICAgICAgaWYgKEludGxTdXBwb3J0LkNvbGxhdG9yKHRoaXMubGFuZ3VhZ2VDb2RlKSA9PSBmYWxzZSkge1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIDA7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gR2V0cyB0aGUgdmFsdWUgb2YgdHJhbnNsYXRpb24gZm9yIHRoZSBrZXlzLlxyXG4gICAgICAgIHZhciB2YWx1ZTE6IHN0cmluZyA9IHRoaXMudHJhbnNsYXRlKGtleTEpO1xyXG4gICAgICAgIHZhciB2YWx1ZTI6IHN0cmluZyA9IHRoaXMudHJhbnNsYXRlKGtleTIpOztcclxuXHJcbiAgICAgICAgdmFyIGxvY2FsZTogc3RyaW5nID0gdGhpcy5hZGRFeHRlbnNpb24odGhpcy5sYW5ndWFnZUNvZGUsIGV4dGVuc2lvbik7XHJcblxyXG4gICAgICAgIHJldHVybiBuZXcgSW50bC5Db2xsYXRvcihsb2NhbGUpLmNvbXBhcmUodmFsdWUxLCB2YWx1ZTIpO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFNvcnRzIGFuIGFycmF5IG9mIG9iamVjdHMgb3IgYW4gYXJyYXkgb2YgYXJyYXlzIGJ5IHRoZSBjdXJyZW50IGxhbmd1YWdlIGNvZGUuXHJcbiAgICAgKiBcclxuICAgICAqIEBwYXJhbSBsaXN0IFRoZSBhcnJheSB0byBiZSBzb3J0ZWRcclxuICAgICAqIEBwYXJhbSBrZXlOYW1lIFRoZSBjb2x1bW4gdGhhdCBjb250YWlucyB0aGUga2V5cyBvZiB0aGUgdmFsdWVzIHRvIGJlIG9yZGVyZWRcclxuICAgICAqIEBwYXJhbSBvcmRlciAnYXNjJyBvciAnZGVzYycuIFRoZSBkZWZhdWx0IHZhbHVlIGlzICdhc2MnLlxyXG4gICAgICogQHBhcmFtIGV4dGVuc2lvblxyXG4gICAgICogQHBhcmFtIG9wdGlvbnNcclxuICAgICAqIEByZXR1cm4gVGhlIHNhbWUgc29ydGVkIGxpc3Qgb3IgdGhlIHNhbWUgbGlzdCBpZiBJbnRsLkNvbGxhdG9yIGlzIG5vdCBzdXBwb3J0ZWRcclxuICAgICAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvQ29sbGF0b3JcclxuICAgICAqL1xyXG4gICAgc29ydChsaXN0OiBBcnJheTxhbnk+LCBrZXlOYW1lOiBhbnksIG9yZGVyPzogc3RyaW5nLCBleHRlbnNpb24/OiBzdHJpbmcsIG9wdGlvbnM/OiBhbnkpOiBBcnJheTxhbnk+IHtcclxuXHJcbiAgICAgICAgaWYgKGxpc3QgPT0gbnVsbCB8fCBrZXlOYW1lID09IG51bGwgfHwgSW50bFN1cHBvcnQuQ29sbGF0b3IodGhpcy5sYW5ndWFnZUNvZGUpID09IGZhbHNlKSByZXR1cm4gbGlzdDtcclxuXHJcbiAgICAgICAgLy8gR2V0cyB0aGUgdmFsdWUgb2YgdHJhbnNsYXRpb24gZm9yIHRoZSBrZXlzLlxyXG4gICAgICAgIGZvciAobGV0IGl0ZW0gb2YgbGlzdCkge1xyXG5cclxuICAgICAgICAgICAgLy8gR2V0cyB0aGUgdmFsdWUgb2YgdHJhbnNsYXRpb24gZm9yIHRoZSBrZXkuXHJcbiAgICAgICAgICAgIHZhciB2YWx1ZTogc3RyaW5nID0gdGhpcy50cmFuc2xhdGUoaXRlbVtrZXlOYW1lXSk7XHJcbiAgICAgICAgICAgIC8vIEFkZHMgYSBuZXcgY29sdW1uIGZvciB0cmFuc2xhdGVkIHZhbHVlcy5cclxuICAgICAgICAgICAgdmFyIHRyYW5zbGF0ZWQ6IHN0cmluZyA9IGtleU5hbWUuY29uY2F0KFwiVHJhbnNsYXRlZFwiKVxyXG4gICAgICAgICAgICAvLyBVcGRhdGVzIHRoZSB2YWx1ZSBpbiB0aGUgbGlzdC5cclxuICAgICAgICAgICAgaXRlbVt0cmFuc2xhdGVkXSA9IHZhbHVlO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBsb2NhbGU6IHN0cmluZyA9IHRoaXMuYWRkRXh0ZW5zaW9uKHRoaXMubGFuZ3VhZ2VDb2RlLCBleHRlbnNpb24pO1xyXG5cclxuICAgICAgICAvLyBJbnRsLkNvbGxhdG9yLlxyXG4gICAgICAgIHZhciBjb2xsYXRvciA9IG5ldyBJbnRsLkNvbGxhdG9yKGxvY2FsZSwgb3B0aW9ucyk7IC8vIEl0IGNhbiBiZSBwYXNzZWQgZGlyZWN0bHkgdG8gQXJyYXkucHJvdG90eXBlLnNvcnQuXHJcblxyXG4gICAgICAgIGxpc3Quc29ydCgoYSwgYikgPT4ge1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGNvbGxhdG9yLmNvbXBhcmUoYVt0cmFuc2xhdGVkXSwgYlt0cmFuc2xhdGVkXSk7XHJcblxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBSZW1vdmVzIHRoZSBjb2x1bW4gb2YgdHJhbnNsYXRlZCB2YWx1ZXMuXHJcbiAgICAgICAgdmFyIGluZGV4ID0gbGlzdC5pbmRleE9mKHRyYW5zbGF0ZWQsIDApO1xyXG4gICAgICAgIGlmIChpbmRleCA+IC0xKSB7XHJcbiAgICAgICAgICAgIGxpc3Quc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIERlc2NlbmRpbmcgb3JkZXIuXHJcbiAgICAgICAgaWYgKG9yZGVyICE9IG51bGwgJiYgb3JkZXIgPT0gJ2Rlc2MnKSB7XHJcblxyXG4gICAgICAgICAgICBsaXN0LnJldmVyc2UoKTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gbGlzdDtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTb3J0cyBhbiBhcnJheSBvZiBvYmplY3RzIG9yIGFuIGFycmF5IG9mIGFycmF5cyBieSB0aGUgY3VycmVudCBsYW5ndWFnZSBjb2RlLlxyXG4gICAgICogXHJcbiAgICAgKiBAcGFyYW0gbGlzdCBUaGUgYXJyYXkgdG8gYmUgc29ydGVkXHJcbiAgICAgKiBAcGFyYW0ga2V5TmFtZSBUaGUgY29sdW1uIHRoYXQgY29udGFpbnMgdGhlIGtleXMgb2YgdGhlIHZhbHVlcyB0byBiZSBvcmRlcmVkXHJcbiAgICAgKiBAcGFyYW0gb3JkZXIgJ2FzYycgb3IgJ2Rlc2MnLiBUaGUgZGVmYXVsdCB2YWx1ZSBpcyAnYXNjJy5cclxuICAgICAqIEBwYXJhbSBleHRlbnNpb25cclxuICAgICAqIEBwYXJhbSBvcHRpb25zXHJcbiAgICAgKiBAcmV0dXJuIEFuIG9ic2VydmFibGUgb2YgdGhlIHNvcnRlZCBsaXN0IG9yIG9mIHRoZSBzYW1lIGxpc3QgaWYgSW50bC5Db2xsYXRvciBpcyBub3Qgc3VwcG9ydGVkXHJcbiAgICAgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL0NvbGxhdG9yXHJcbiAgICAgKi9cclxuICAgIHNvcnRBc3luYyhsaXN0OiBBcnJheTxhbnk+LCBrZXlOYW1lOiBhbnksIG9yZGVyPzogc3RyaW5nLCBleHRlbnNpb24/OiBzdHJpbmcsIG9wdGlvbnM/OiBhbnkpOiBPYnNlcnZhYmxlPEFycmF5PGFueT4+IHtcclxuXHJcbiAgICAgICAgcmV0dXJuIG5ldyBPYnNlcnZhYmxlPGFueT4oKG9ic2VydmVyOiBPYnNlcnZlcjxBcnJheTxhbnk+PikgPT4ge1xyXG5cclxuICAgICAgICAgICAgLy8gR2V0cyB0aGUgc29ydGVkIGxpc3QuXHJcbiAgICAgICAgICAgIG9ic2VydmVyLm5leHQodGhpcy5zb3J0KGxpc3QsIGtleU5hbWUsIG9yZGVyLCBleHRlbnNpb24sIG9wdGlvbnMpKTtcclxuICAgICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcclxuXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogTWF0Y2hlcyBhIHN0cmluZyBpbnRvIGFuIGFycmF5IG9mIG9iamVjdHMgb3IgYW4gYXJyYXkgb2YgYXJyYXlzLlxyXG4gICAgICogXHJcbiAgICAgKiBAcGFyYW0gcyBUaGUgc3RyaW5nIHRvIHNlYXJjaFxyXG4gICAgICogQHBhcmFtIGxpc3QgVGhlIGFycmF5IHRvIGxvb2sgZm9yXHJcbiAgICAgKiBAcGFyYW0ga2V5TmFtZXMgQW4gYXJyYXkgdGhhdCBjb250YWlucyB0aGUgY29sdW1ucyB0byBsb29rIGZvclxyXG4gICAgICogQHBhcmFtIG9wdGlvbnNcclxuICAgICAqIEByZXR1cm4gQSBmaWx0ZXJlZCBsaXN0IG9yIHRoZSBzYW1lIGxpc3QgaWYgSW50bC5Db2xsYXRvciBpcyBub3Qgc3VwcG9ydGVkXHJcbiAgICAgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL0NvbGxhdG9yXHJcbiAgICAgKi9cclxuICAgIHNlYXJjaChzOiBzdHJpbmcsIGxpc3Q6IEFycmF5PGFueT4sIGtleU5hbWVzOiBhbnlbXSwgb3B0aW9uczogYW55ID0geyB1c2FnZTogJ3NlYXJjaCcgfSk6IEFycmF5PGFueT4ge1xyXG5cclxuICAgICAgICBpZiAobGlzdCA9PSBudWxsIHx8IGtleU5hbWVzID09IG51bGwgfHwgcyA9PSBcIlwiIHx8IEludGxTdXBwb3J0LkNvbGxhdG9yKHRoaXMubGFuZ3VhZ2VDb2RlKSA9PSBmYWxzZSkgcmV0dXJuIGxpc3Q7XHJcblxyXG4gICAgICAgIC8vIEdldHMgdGhlIHZhbHVlIG9mIHRyYW5zbGF0aW9uIGZvciB0aGUgZWFjaCBjb2x1bW4uXHJcbiAgICAgICAgdmFyIHRyYW5zbGF0ZWQgPSBuZXcgQXJyYXk8c3RyaW5nPigpO1xyXG5cclxuICAgICAgICB2YXIgaTogbnVtYmVyID0gMDtcclxuICAgICAgICBmb3IgKHZhciBpOiBudW1iZXIgPSAwOyBpIDwga2V5TmFtZXMubGVuZ3RoOyBpKyspIHtcclxuXHJcbiAgICAgICAgICAgIC8vIEFkZHMgYSBuZXcgY29sdW1uIGZvciB0cmFuc2xhdGVkIHZhbHVlcy5cclxuICAgICAgICAgICAgdHJhbnNsYXRlZC5wdXNoKGtleU5hbWVzW2ldLmNvbmNhdChcIlRyYW5zbGF0ZWRcIikpO1xyXG5cclxuICAgICAgICAgICAgZm9yIChsZXQgaXRlbSBvZiBsaXN0KSB7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gR2V0cyB0aGUgdmFsdWVzIG9mIHRyYW5zbGF0aW9uIGZvciB0aGUgY29sdW1uLlxyXG4gICAgICAgICAgICAgICAgdmFyIHZhbHVlOiBzdHJpbmcgPSB0aGlzLnRyYW5zbGF0ZShpdGVtW2tleU5hbWVzW2ldXSk7XHJcbiAgICAgICAgICAgICAgICAvLyBVcGRhdGVzIHRoZSB2YWx1ZSBpbiB0aGUgbGlzdC5cclxuICAgICAgICAgICAgICAgIGl0ZW1bdHJhbnNsYXRlZFtpXV0gPSB2YWx1ZTtcclxuXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgbG9jYWxlOiBzdHJpbmcgPSB0aGlzLmxhbmd1YWdlQ29kZTtcclxuXHJcbiAgICAgICAgLy8gSW50bC5Db2xsYXRvci5cclxuICAgICAgICB2YXIgY29sbGF0b3IgPSBuZXcgSW50bC5Db2xsYXRvcihsb2NhbGUsIG9wdGlvbnMpO1xyXG5cclxuICAgICAgICB2YXIgbWF0Y2hlcyA9IGxpc3QuZmlsdGVyKCh2KSA9PiB7XHJcblxyXG4gICAgICAgICAgICB2YXIgZm91bmQ6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaTogbnVtYmVyID0gMDsgaSA8IHRyYW5zbGF0ZWQubGVuZ3RoOyBpKyspIHtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBDYWxscyBtYXRjaGluZyBhbGdvcml0aG0uXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5tYXRjaCh2W3RyYW5zbGF0ZWRbaV1dLCBzLCBjb2xsYXRvcikpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBmb3VuZDtcclxuXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIFJlbW92ZXMgdGhlIGNvbHVtbnMgb2YgdHJhbnNsYXRlZCB2YWx1ZXMuXHJcbiAgICAgICAgZm9yICh2YXIgaTogbnVtYmVyID0gMDsgaSA8IHRyYW5zbGF0ZWQubGVuZ3RoOyBpKyspIHtcclxuXHJcbiAgICAgICAgICAgIHZhciBpbmRleCA9IG1hdGNoZXMuaW5kZXhPZih0cmFuc2xhdGVkW2ldLCAwKTtcclxuICAgICAgICAgICAgaWYgKGluZGV4ID4gLTEpIHtcclxuICAgICAgICAgICAgICAgIG1hdGNoZXMuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBtYXRjaGVzO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIE1hdGNoZXMgYSBzdHJpbmcgaW50byBhbiBhcnJheSBvZiBvYmplY3RzIG9yIGFuIGFycmF5IG9mIGFycmF5cy5cclxuICAgICAqIFxyXG4gICAgICogQHBhcmFtIHMgVGhlIHN0cmluZyB0byBzZWFyY2hcclxuICAgICAqIEBwYXJhbSBsaXN0IFRoZSBhcnJheSB0byBsb29rIGZvclxyXG4gICAgICogQHBhcmFtIGtleU5hbWVzIEFuIGFycmF5IHRoYXQgY29udGFpbnMgdGhlIGNvbHVtbnMgdG8gbG9vayBmb3JcclxuICAgICAqIEBwYXJhbSBvcHRpb25zXHJcbiAgICAgKiBAcmV0dXJuIEFuIG9ic2VydmFibGUgZm9yIGVhY2ggZWxlbWVudCBvZiB0aGUgZmlsdGVyZWQgbGlzdCBvciB0aGUgc2FtZSBsaXN0IGlmIEludGwuQ29sbGF0b3IgaXMgbm90IHN1cHBvcnRlZFxyXG4gICAgICogQHNlZSBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9HbG9iYWxfT2JqZWN0cy9Db2xsYXRvclxyXG4gICAgICovXHJcbiAgICBzZWFyY2hBc3luYyhzOiBzdHJpbmcsIGxpc3Q6IEFycmF5PGFueT4sIGtleU5hbWVzOiBhbnlbXSwgb3B0aW9uczogYW55ID0geyB1c2FnZTogJ3NlYXJjaCcgfSk6IE9ic2VydmFibGU8YW55PiB7XHJcblxyXG4gICAgICAgIGlmIChsaXN0ID09IG51bGwpIHJldHVybiBudWxsO1xyXG5cclxuICAgICAgICBpZiAoa2V5TmFtZXMgPT0gbnVsbCB8fCBzID09IFwiXCIgfHwgSW50bFN1cHBvcnQuQ29sbGF0b3IodGhpcy5sYW5ndWFnZUNvZGUpID09IGZhbHNlKSByZXR1cm4gbmV3IE9ic2VydmFibGU8YW55Pigob2JzZXJ2ZXI6IE9ic2VydmVyPGFueT4pID0+IHtcclxuXHJcbiAgICAgICAgICAgIGZvciAobGV0IGl0ZW0gb2YgbGlzdCkge1xyXG5cclxuICAgICAgICAgICAgICAgIG9ic2VydmVyLm5leHQoaXRlbSk7XHJcblxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xyXG5cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIG5ldyBPYnNlcnZhYmxlPGFueT4oKG9ic2VydmVyOiBPYnNlcnZlcjxhbnk+KSA9PiB7XHJcblxyXG4gICAgICAgICAgICAvLyBHZXRzIHRoZSB2YWx1ZSBvZiB0cmFuc2xhdGlvbiBmb3IgdGhlIGVhY2ggY29sdW1uLlxyXG4gICAgICAgICAgICB2YXIgdHJhbnNsYXRlZCA9IG5ldyBBcnJheTxzdHJpbmc+KCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgaTogbnVtYmVyID0gMDtcclxuICAgICAgICAgICAgZm9yICh2YXIgaTogbnVtYmVyID0gMDsgaSA8IGtleU5hbWVzLmxlbmd0aDsgaSsrKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gQWRkcyBhIG5ldyBjb2x1bW4gZm9yIHRyYW5zbGF0ZWQgdmFsdWVzLlxyXG4gICAgICAgICAgICAgICAgdHJhbnNsYXRlZC5wdXNoKGtleU5hbWVzW2ldLmNvbmNhdChcIlRyYW5zbGF0ZWRcIikpO1xyXG5cclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGl0ZW0gb2YgbGlzdCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBHZXRzIHRoZSB2YWx1ZXMgb2YgdHJhbnNsYXRpb24gZm9yIHRoZSBjb2x1bW4uXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlOiBzdHJpbmcgPSB0aGlzLnRyYW5zbGF0ZShpdGVtW2tleU5hbWVzW2ldXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlcyB0aGUgdmFsdWUgaW4gdGhlIGxpc3QuXHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbVt0cmFuc2xhdGVkW2ldXSA9IHZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHZhciBsb2NhbGU6IHN0cmluZyA9IHRoaXMubGFuZ3VhZ2VDb2RlO1xyXG5cclxuICAgICAgICAgICAgLy8gSW50bC5Db2xsYXRvci5cclxuICAgICAgICAgICAgdmFyIGNvbGxhdG9yID0gbmV3IEludGwuQ29sbGF0b3IobG9jYWxlLCBvcHRpb25zKTtcclxuXHJcbiAgICAgICAgICAgIGZvciAobGV0IHYgb2YgbGlzdCkge1xyXG5cclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGk6IG51bWJlciA9IDA7IGkgPCB0cmFuc2xhdGVkLmxlbmd0aDsgaSsrKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIENhbGxzIG1hdGNoaW5nIGFsZ29yaXRobS5cclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5tYXRjaCh2W3RyYW5zbGF0ZWRbaV1dLCBzLCBjb2xsYXRvcikpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLm5leHQodik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gUmVtb3ZlcyB0aGUgY29sdW1ucyBvZiB0cmFuc2xhdGVkIHZhbHVlcy5cclxuICAgICAgICAgICAgZm9yICh2YXIgaTogbnVtYmVyID0gMDsgaSA8IHRyYW5zbGF0ZWQubGVuZ3RoOyBpKyspIHtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSBsaXN0LmluZGV4T2YodHJhbnNsYXRlZFtpXSwgMCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxpc3Quc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xyXG5cclxuICAgICAgICB9KTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBhZGRFeHRlbnNpb24obG9jYWxlOiBzdHJpbmcsIGV4dGVuc2lvbj86IHN0cmluZyk6IHN0cmluZyB7XHJcblxyXG4gICAgICAgIC8vIEFkZHMgZXh0ZW5zaW9uLlxyXG4gICAgICAgIGlmIChleHRlbnNpb24gIT0gbnVsbCAmJiBleHRlbnNpb24gIT0gXCJcIikge1xyXG5cclxuICAgICAgICAgICAgbG9jYWxlID0gbG9jYWxlICsgXCItXCIgKyBleHRlbnNpb247XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGxvY2FsZTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBNYXRjaGluZyBhbGdvcml0aG0uXHJcbiAgICAgKiBcclxuICAgICAqIEBwYXJhbSB2IFRoZSB2YWx1ZVxyXG4gICAgICogQHBhcmFtIHMgVGhlIHN0cmluZyB0byBzZWFyY2hcclxuICAgICAqIHJldHVybiBUcnVlIGlmIG1hdGNoLCBvdGhlcndpc2UgZmFsc2VcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBtYXRjaCh2OiBzdHJpbmcsIHM6IHN0cmluZywgY29sbGF0b3I6IEludGwuQ29sbGF0b3IpOiBib29sZWFuIHtcclxuXHJcbiAgICAgICAgdmFyIHZMZW5ndGg6IG51bWJlciA9IHYubGVuZ3RoO1xyXG4gICAgICAgIHZhciBzTGVuZ3RoOiBudW1iZXIgPSBzLmxlbmd0aDtcclxuXHJcbiAgICAgICAgaWYgKHNMZW5ndGggPiB2TGVuZ3RoKSByZXR1cm4gZmFsc2U7IC8vIFRoZSBzZWFyY2ggc3RyaW5nIGlzIGxvbmdlciB0aGFuIHZhbHVlLlxyXG5cclxuICAgICAgICBpZiAoc0xlbmd0aCA9PSB2TGVuZ3RoKSB7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gY29sbGF0b3IuY29tcGFyZSh2LCBzKSA9PT0gMDtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBUcmllcyB0byBzZWFyY2ggdGhlIHN1YnN0cmluZy5cclxuICAgICAgICB2YXIgZm91bmQ6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgICAgICBmb3IgKHZhciBpOiBudW1iZXIgPSAwOyBpIDwgdkxlbmd0aCAtIChzTGVuZ3RoIC0gMSk7IGkrKykge1xyXG5cclxuICAgICAgICAgICAgdmFyIHN0cjogc3RyaW5nID0gdi5zdWJzdHIoaSwgc0xlbmd0aCk7XHJcbiAgICAgICAgICAgIGlmIChjb2xsYXRvci5jb21wYXJlKHN0ciwgcykgPT09IDApIHtcclxuXHJcbiAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gZm91bmQ7XHJcblxyXG4gICAgfVxyXG5cclxufVxyXG5cclxuLyoqXHJcbiAqIERlZmluZXMgdGhlIHNlcnZpY2Ugc3RhdGUuXHJcbiAqL1xyXG5leHBvcnQgZW51bSBTZXJ2aWNlU3RhdGUge1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogVGhlIHRyYW5zbGF0aW9uIGRhdGEgaGFzIGJlZW4gbG9hZGVkLlxyXG4gICAgICovXHJcbiAgICBpc1JlYWR5LFxyXG4gICAgLyoqXHJcbiAgICAgKiBUaGUgc2VydmljZSBpcyBsb2FkaW5nIHRoZSBkYXRhLlxyXG4gICAgICovXHJcbiAgICBpc0xvYWRpbmcsXHJcbiAgICAvKipcclxuICAgICAqIFRoZSBzZXJ2aWNlIGlzIHdhaXRpbmcgZm9yIHRoZSBkYXRhLlxyXG4gICAgICovXHJcbiAgICBpc1dhaXRpbmdcclxuXHJcbn1cclxuXHJcbi8qKlxyXG4gKiBEZWZpbmVzIHRoZSBsb2FkaW5nIG1vZGUuXHJcbiAqL1xyXG5leHBvcnQgZW51bSBMb2FkaW5nTW9kZSB7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBJbml0aWFsIHN0YXRlLlxyXG4gICAgICovXHJcbiAgICBVbmtub3duLFxyXG4gICAgLyoqXHJcbiAgICAgKiBEaXJlY3QgbG9hZGluZy5cclxuICAgICAqL1xyXG4gICAgRGlyZWN0LFxyXG4gICAgLyoqXHJcbiAgICAgKiBBc3luY2hyb25vdXMgbG9hZGluZy5cclxuICAgICAqL1xyXG4gICAgQXN5bmNcclxuXHJcbn0gIl19